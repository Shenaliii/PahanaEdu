<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Customer</title>
    <link rel="stylesheet" href="../css/cusregistration.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
    
<!-- Top Bar -->
<div class="top-bar">
    <a href="help.html">HELP</a>
    <span>|</span>
    <a href="login.html" class="exit-btn">LOG OUT</a>
</div>

<!-- Header Section -->
<div class="header-bar">
    <div class="header-content">
        <div class="logo">
            <img src="../images/logo.jpeg" alt="Logo">
        </div>
        
        <a href="../html/cart.html">
            <div class="cart-icon">
                <i class="fas fa-shopping-cart"></i>
            </div>
        </a>
    </div>
</div>

<!-- Hero Section -->
<section class="hero-section">
  <h1>Add Customer</h1>
</section>

<!-- Registration Section -->
<section class="registration-section">
  <div class="registration-box">
    <form id="customerForm">
      <div class="form-group">
        <label for="name">Full Name:</label>
        <input type="text" id="name" name="name" required>
      </div>

      <div class="form-group">
        <label for="address">Address:</label>
        <input type="text" id="address" name="address" required>
      </div>

      <div class="form-group">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
      </div>

      <div class="form-group">
        <label for="telephone">Telephone Number:</label>
        <input type="tel" id="telephone" name="telephone" required>
      </div>

      <div class="form-group">
        <label for="account">Customer ID (Auto generated):</label>
        <input type="text" id="account" name="account" readonly>
      </div>

      <div class="button-group">
        <button type="reset" class="btn clear">Clear</button>
        <button type="button" class="btn register" id="registerBtn">Register</button>
      </div>

      <div class="validation-message" id="message"></div>
    </form>
  </div>
</section>

<!-- Footer Section -->
<footer class="footer">
    <p>Â© 2025 Pahana Education. All rights reserved.</p>
</footer>

<script>
const API_BASE = "http://localhost:8080/pahanaedu-service/customers";

document.getElementById("registerBtn").addEventListener("click", async () => {
    const name = document.getElementById("name").value.trim();
    const address = document.getElementById("address").value.trim();
    const email = document.getElementById("email").value.trim();
    const mobile = document.getElementById("telephone").value.trim();
    const messageDiv = document.getElementById("message");

    // Basic validation
    if(!name || !address || !email || !mobile) {
        messageDiv.textContent = "Please fill all fields!";
        messageDiv.style.color = "red";
        return;
    }

    // Prepare payload
    const payload = {
        name: name,
        address: address,
        email: email,
        mobile: mobile,
        unit_consumed: 0 // default
    };

    try {
        const resp = await fetch(API_BASE, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        const data = await resp.json();

        if(resp.ok) {
            messageDiv.textContent = `Customer added successfully! ID: ${data.id}`;
            messageDiv.style.color = "green";
            document.getElementById("account").value = data.id; // Show generated ID
            document.getElementById("customerForm").reset();
        } else {
            messageDiv.textContent = data.error || "Failed to add customer!";
            messageDiv.style.color = "red";
        }

    } catch(e) {
        console.error(e);
        messageDiv.textContent = "Server error! Try again later.";
        messageDiv.style.color = "red";
    }
});
</script>
</body>
</html>
