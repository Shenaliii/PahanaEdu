<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manage Items</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; }
.wrapper { background:#fff; padding:10px 20px; display:flex; justify-content:flex-end; }
.wrapper a { text-decoration:none; margin-left:10px; color:#b5001a; }
.hero-section { padding:20px; text-align:center; background:#b5001a; color:#fff; }
.add-item-section, .items-record-section { padding:20px; margin:10px auto; max-width:1000px; background:#fff; border-radius:6px; box-shadow:0 0 5px rgba(0,0,0,0.1);}
.add-item-box input, .add-item-box select { width:calc(100% - 20px); padding:8px; margin-bottom:10px; }
.add-btn, .clear-btn { padding:8px 16px; margin-right:10px; cursor:pointer; }
.add-btn { background:#b5001a; color:#fff; border:none; }
.clear-btn { background:#ccc; border:none; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
th, td { border:1px solid #ddd; padding:8px; text-align:center; }
th { background:#f0f0f0; }
button { cursor:pointer; border:none; background:none; color:#b5001a; font-size:16px; }
.table-filter-container { display:flex; gap:10px; margin-bottom:10px; align-items:center;}
</style>
</head>
<body>

<div class="wrapper">
  <a href="help.html">HELP</a>
  <span>|</span>
  <a href="login.html">LOG OUT</a>
</div>

<section class="hero-section">
  <h1>Manage Items</h1>
</section>

<section class="add-item-section">
  <div class="add-item-box">
    <h2>Add / Edit Item</h2>
    <form id="itemForm">
      <input type="text" name="name" placeholder="Item Name" required>
      <input type="number" name="price" placeholder="Price" required>
      <input type="number" name="quantity" placeholder="Quantity" required>
      <div class="button-group">
        <button type="reset" class="clear-btn">Clear</button>
        <button type="submit" class="add-btn">Add Item</button>
      </div>
    </form>
  </div>
</section>

<section class="items-record-section">
  <h2>Current Item Records</h2>
  <div class="table-filter-container">
    <input type="text" id="searchInput" placeholder="Search by name or ID">
  </div>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Price</th>
        <th>Quantity</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="itemsTableBody"></tbody>
  </table>
</section>

<footer class="footer" style="text-align:center; margin:20px 0;">Â© 2025 Pahana Education. All rights reserved.</footer>

<script>
const API_BASE = "http://localhost:8080/pahanaedu-service/items";

const itemForm = document.getElementById("itemForm");
const itemsTableBody = document.getElementById("itemsTableBody");
const searchInput = document.getElementById("searchInput");

let itemsData = [];
let editingId = null;

// Load all items
async function loadItems() {
  try {
    const resp = await fetch(`${API_BASE}`);
    itemsData = await resp.json();
    displayItems();
  } catch (err) {
    console.error(err);
    alert("Failed to load items");
  }
}

// Display items with search
function displayItems() {
  const searchTerm = searchInput.value.toLowerCase();
  itemsTableBody.innerHTML = "";
  itemsData.forEach(item => {
    if (item.name.toLowerCase().includes(searchTerm) || item.id.toString().includes(searchTerm)) {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${item.id}</td>
        <td>${item.name}</td>
        <td>${item.price.toFixed(2)}</td>
        <td>${item.quantity}</td>
        <td>
          <button class="edit-btn" data-id="${item.id}"><i class="fas fa-pen"></i></button>
          <button class="delete-btn" data-id="${item.id}"><i class="fas fa-trash"></i></button>
        </td>
      `;
      itemsTableBody.appendChild(row);
    }
  });
  attachActions();
}

// Edit/Delete actions
function attachActions() {
  document.querySelectorAll(".delete-btn").forEach(btn => {
    btn.onclick = async () => {
      const id = btn.dataset.id;
      if (confirm("Delete this item?")) {
        try {
          const resp = await fetch(`${API_BASE}/${id}`, { method: "DELETE" });
          if (resp.ok) { 
            alert("Item deleted"); 
            loadItems(); 
          } else alert("Failed to delete");
        } catch (err) {
          console.error(err);
          alert("Error deleting item");
        }
      }
    };
  });

  document.querySelectorAll(".edit-btn").forEach(btn => {
    btn.onclick = async () => {
      const id = btn.dataset.id;
      try {
        const resp = await fetch(`${API_BASE}/${id}`);
        const item = await resp.json();
        itemForm.name.value = item.name;
        itemForm.price.value = item.price;
        itemForm.quantity.value = item.quantity;
        itemForm.querySelector(".add-btn").textContent = "Update";
        editingId = item.id;
      } catch (err) {
        console.error(err);
        alert("Error fetching item");
      }
    };
  });
}

// Add/Update item
itemForm.onsubmit = async e => {
  e.preventDefault();
  const data = {
    name: itemForm.name.value,
    price: parseFloat(itemForm.price.value),
    quantity: parseInt(itemForm.quantity.value),
  };
  const method = editingId ? "PUT" : "POST";
  const url = editingId ? `${API_BASE}/${editingId}` : `${API_BASE}`;
  try {
    const resp = await fetch(url, {
      method,
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const result = await resp.json();
    alert("Item saved successfully");
    itemForm.reset();
    itemForm.querySelector(".add-btn").textContent = "Add Item";
    editingId = null;
    loadItems();
  } catch (err) {
    console.error(err);
    alert("Failed to save");
  }
};

// Search filter
searchInput.oninput = displayItems;

// Initial load
loadItems();
</script>

</body>
</html>
